# VitePress ç«™ç‚¹éƒ¨ç½²åˆ° GitHub Pages çš„å·¥ä½œæµé…ç½®
# æœ¬å·¥ä½œæµç”¨äºè‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½² VitePress ç«™ç‚¹åˆ° GitHub Pages

# å·¥ä½œæµåç§°
name: Deploy VitePress site to Pages

# è§¦å‘æ¡ä»¶ï¼šå®šä¹‰å·¥ä½œæµåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¿è¡Œ
on:
  # å½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  # å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ master åˆ†æ”¯ä½œä¸ºé»˜è®¤åˆ†æ”¯ï¼Œè¯·å°†è¿™é‡Œæ”¹ä¸º master
  push:
    branches: [main]

  # å…è®¸ä» GitHub Actions é€‰é¡¹å¡æ‰‹åŠ¨è§¦å‘æ­¤å·¥ä½œæµ
  workflow_dispatch:

# æƒé™é…ç½®ï¼šè®¾ç½® GITHUB_TOKEN çš„æƒé™ï¼Œå…è®¸éƒ¨ç½²åˆ° GitHub Pages
permissions:
  contents: read # è¯»å–ä»£ç ä»“åº“å†…å®¹çš„æƒé™
  pages: write # å†™å…¥ GitHub Pages çš„æƒé™
  id-token: write # å†™å…¥ ID ä»¤ç‰Œçš„æƒé™

# å¹¶å‘é…ç½®ï¼šæ§åˆ¶åŒæ—¶è¿è¡Œçš„éƒ¨ç½²ä½œä¸šæ•°é‡
# å…è®¸åªæœ‰ä¸€ä¸ªå¹¶å‘éƒ¨ç½²ï¼Œè·³è¿‡åœ¨è¿›è¡Œä¸­çš„è¿è¡Œå’Œæœ€æ–°æ’é˜Ÿçš„è¿è¡Œä¹‹é—´çš„æ’é˜Ÿè¿è¡Œ
# ä½†æ˜¯ï¼Œä¸è¦å–æ¶ˆè¿›è¡Œä¸­çš„è¿è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å…è®¸è¿™äº›ç”Ÿäº§éƒ¨ç½²å®Œæˆ
concurrency:
  group: pages
  cancel-in-progress: false

# ä½œä¸šå®šä¹‰ï¼šå·¥ä½œæµåŒ…å«çš„ä¸€ç³»åˆ—ä»»åŠ¡
jobs:
  # æ„å»ºä½œä¸šï¼šè´Ÿè´£æ„å»º VitePress ç«™ç‚¹
  build:
    # æŒ‡å®šè¿è¡Œç¯å¢ƒä¸ºæœ€æ–°çš„ Ubuntu ç³»ç»Ÿ
    runs-on: ubuntu-latest
    # æ„å»ºæ­¥éª¤
    steps:
      # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç ä»“åº“
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # å¦‚æœæœªå¯ç”¨ lastUpdated åŠŸèƒ½ï¼Œåˆ™ä¸éœ€è¦æ­¤è®¾ç½®

      # å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ pnpm åŒ…ç®¡ç†å™¨ï¼Œè¯·å–æ¶ˆä¸‹é¢å‡ è¡Œçš„æ³¨é‡Š
      - uses: pnpm/action-setup@v3
        # ğŸ‘‡ æŒ‡å®š pnpm ç‰ˆæœ¬
        with:
          version: 10.17.0 # å¦‚æœæ‚¨åœ¨ package.json ä¸­è®¾ç½®äº† "packageManager"ï¼Œåˆ™ä¸éœ€è¦æ­¤è®¾ç½®

      # å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Bun è¿è¡Œæ—¶ï¼Œè¯·å–æ¶ˆä¸‹é¢ä¸€è¡Œçš„æ³¨é‡Š
      # - uses: oven-sh/setup-bun@v1

      # æ­¥éª¤2ï¼šè®¾ç½® Node.js ç¯å¢ƒ
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 22 # ä½¿ç”¨ Node.js 22 ç‰ˆæœ¬
          cache: pnpm # ä½¿ç”¨ npm ç¼“å­˜ä¾èµ–ï¼ˆä¹Ÿå¯ä»¥é€‰æ‹© pnpm æˆ– yarnï¼‰

      # æ­¥éª¤3ï¼šé…ç½® GitHub Pages
      - name: Setup Pages
        uses: actions/configure-pages@v4

      # æ­¥éª¤4ï¼šå®‰è£…é¡¹ç›®ä¾èµ–
      - name: Install dependencies
        run: pnpm install # æ ¹æ®æ‚¨ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨ï¼Œå¯ä»¥æ›¿æ¢ä¸º pnpm install / yarn install / bun install

      # æ­¥éª¤5ï¼šä½¿ç”¨ VitePress æ„å»ºç«™ç‚¹
      - name: Build with VitePress
        run: pnpm run docs:build # æ ¹æ®æ‚¨ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨ï¼Œå¯ä»¥æ›¿æ¢ä¸º pnpm docs:build / yarn docs:build / bun run docs:build

      # æ­¥éª¤6ï¼šä¸Šä¼ æ„å»ºäº§ç‰©ä½œä¸º GitHub Pages éƒ¨ç½²çš„åˆ¶å“
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs/.vitepress/dist # VitePress æ„å»ºè¾“å‡ºç›®å½•

  # éƒ¨ç½²ä½œä¸šï¼šè´Ÿè´£å°†æ„å»ºå¥½çš„ç«™ç‚¹éƒ¨ç½²åˆ° GitHub Pages
  deploy:
    # éƒ¨ç½²ç¯å¢ƒé…ç½®
    environment:
      name: github-pages # ç¯å¢ƒåç§°
      url: ${{ steps.deployment.outputs.page_url }} # éƒ¨ç½²åçš„é¡µé¢ URL
    needs: build # ä¾èµ–å…³ç³»ï¼šéƒ¨ç½²ä½œä¸šä¾èµ–äºæ„å»ºä½œä¸šå®Œæˆ
    runs-on: ubuntu-latest # è¿è¡Œç¯å¢ƒ
    name: Deploy # ä½œä¸šåç§°
    steps:
      # æ­¥éª¤ï¼šå°†æ„å»ºå¥½çš„ç«™ç‚¹éƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
