---
date: "2025-09-20T17:14:39+08:00"
---
# 优先级队列的封装

优先级队列是一种特殊的队列，其中的每个元素都有一个优先级。在优先级队列中，元素的出队顺序是按照优先级的高低决定的，而不是按照它们进入队列的顺序。在这篇文章中，我们将使用JavaScript封装一个优先级队列类，并通过实例来展示其应用。

## 一、优先级队列类的封装

以下是一个基础的优先级队列类实现，包含了优先级队列的常见操作：

```javascript
// 封装优先级队列
function PriorityQueue() {
    // 封装队列的元素类
    function QueueElement(element, priority) {
        this.element = element
        this.priority = priority
    }
    
    // 属性
    this.items = []
    
    // 方法
    // 插入一个元素
    PriorityQueue.prototype.enqueue = function (element, priority) {
        // 创建队列元素
        let queueElement = new QueueElement(element, priority)
        
        // 判断队列中是否有元素，若没有则直接插入
        if (this.items.length == 0) {
            this.items.push(queueElement)
        } else {
            // 有元素则比较，再将其插入
            let added = false
            for (let i = 0; i < this.items.length; i++) {
                if (queueElement.priority < this.items[i].priority) {
                    // 符合判断则插入元素（优先级数字越小，优先级越高）
                    this.items.splice(i, 0, queueElement)
                    added = true
                    break
                }
            }
            // 所有元素比较完，但依然不符合条件
            if (!added) {
                this.items.push(queueElement)
            }
        }
    }

    // delqueue:移除队列头部的第一个元素，并将其返回
    PriorityQueue.prototype.delqueue = function () {
        return this.items.shift()
    }
    
    // front:返回队列中第一个元素，队列不受影响
    PriorityQueue.prototype.front = function () {
        return this.items[0]
    }
    
    // isEmpty:队列为空则返回true，否则返回false
    PriorityQueue.prototype.isEmpty = function () {
        return this.items.length == 0
    }
    
    // size:返回队列元素的个数
    PriorityQueue.prototype.size = function () {
        return this.items.length
    }
    
    // toString:将队列中的内容转换为字符串形式
    PriorityQueue.prototype.toString = function () {
        let str = ''
        for (let i = 0; i < this.items.length; i++) {
            str += this.items[i].element
        }
        return str
    }
}
```

## 二、优先级队列的基本使用示例

下面是优先级队列类的基本使用方法示例：

```javascript
// 创建一个优先级队列实例
let pq = new PriorityQueue()

// 添加元素（元素值，优先级）
pq.enqueue('aaa', 20)
pq.enqueue('fff', 15)
pq.enqueue('ggg', 201)
pq.enqueue('www', 105)
pq.enqueue('xxx', 8)
pq.enqueue('qqq', 333)

// 获取队列大小
console.log(pq.size()); // 输出: 6

// 查看队首元素
console.log(pq.front()); // 输出: {element: "xxx", priority: 8}

// 查看队列内容（按优先级排序）
console.log(pq.toString()); // 输出: xxxfffaawwwgggqqq

// 出队操作
let dequeued = pq.delqueue()
console.log(dequeued); // 输出: {element: "xxx", priority: 8}
console.log(pq.size()); // 输出: 5
console.log(pq.toString()); // 输出: fffaawwwgggqqq

// 判断队列是否为空
console.log(pq.isEmpty()); // 输出: false
```

## 三、增强版toString方法

为了更好地展示队列中的元素及其优先级，我们可以增强toString方法：

```javascript
// 增强版toString方法（显示元素和优先级）
PriorityQueue.prototype.toStringEnhanced = function () {
    let str = '['
    for (let i = 0; i < this.items.length; i++) {
        if (i > 0) {
            str += ', '
        }
        str += `{element: "${this.items[i].element}", priority: ${this.items[i].priority}}`
    }
    str += ']'
    return str
}

// 使用增强版toString方法
console.log(pq.toStringEnhanced());
// 输出类似: [{element: "fff", priority: 15}, {element: "aaa", priority: 20}, {element: "www", priority: 105}, {element: "ggg", priority: 201}, {element: "qqq", priority: 333}]
```

## 四、优先级队列的实际应用

优先级队列在许多场景中都有应用，例如：

1. 任务调度系统（按照优先级处理任务）
2. 图算法（如Dijkstra算法中的最短路径查找）
3. 事件处理系统
4. 网络流量管理

下面是一个简单的任务调度系统示例：

```javascript
// 简单的任务调度系统
function TaskScheduler() {
    // 使用优先级队列存储任务
    let taskQueue = new PriorityQueue()
    
    // 添加任务
    this.addTask = function (taskName, priority) {
        taskQueue.enqueue(taskName, priority)
        console.log(`Task "${taskName}" added with priority ${priority}`)
    }
    
    // 处理下一个任务
    this.processNextTask = function () {
        if (taskQueue.isEmpty()) {
            console.log("No tasks to process")
            return null
        }
        
        let nextTask = taskQueue.delqueue()
        console.log(`Processing task: "${nextTask.element}" (priority: ${nextTask.priority})`)
        return nextTask
    }
    
    // 获取任务队列大小
    this.getTaskCount = function () {
        return taskQueue.size()
    }
}

// 测试任务调度系统
let scheduler = new TaskScheduler()

scheduler.addTask("紧急修复bug", 1)
scheduler.addTask("优化性能", 3)
scheduler.addTask("添加新功能", 5)
scheduler.addTask("数据库备份", 2)
scheduler.addTask("发送周报", 4)

console.log(`Total tasks: ${scheduler.getTaskCount()}`)

// 按优先级处理任务
while (scheduler.getTaskCount() > 0) {
    scheduler.processNextTask()
}
```

## 五、算法原理解析

### 优先级队列的排序原理

在我们的实现中，优先级队列的排序基于以下原理：

1. 当插入新元素时，我们遍历当前队列中的所有元素
2. 比较新元素与队列中元素的优先级
3. 找到第一个优先级大于新元素的位置，将新元素插入到该位置前
4. 如果所有元素的优先级都小于等于新元素，则将新元素插入到队列末尾

这种实现方式确保了队列始终按照优先级排序，优先级数字越小的元素越靠近队首。

## 六、性能分析

我们当前实现的优先级队列类使用JavaScript数组作为底层数据结构：

- **入队操作（enqueue）**：时间复杂度为O(n)，因为需要遍历队列以找到合适的插入位置
- **出队操作（delqueue）**：时间复杂度为O(n)，因为需要移除数组的第一个元素并将后面的所有元素前移一位
- **查看队首元素（front）**：时间复杂度为O(1)
- **判断队列是否为空（isEmpty）**：时间复杂度为O(1)
- **获取队列大小（size）**：时间复杂度为O(1)

对于大型数据集，这种实现可能不是最高效的。在实际应用中，可以考虑使用二叉堆（Binary Heap）来实现优先级队列，这样可以将入队和出队操作的时间复杂度优化到O(log n)。

## 七、ES6 版本的优先级队列实现

使用ES6的类语法可以更优雅地实现优先级队列：

```javascript
// ES6 版本的优先级队列实现
class PriorityQueue {
    constructor() {
        // 使用数组存储队列元素
        this.items = []
    }
    
    // 内部类：表示队列中的元素
    _QueueElement(element, priority) {
        this.element = element
        this.priority = priority
    }
    
    // 入队：插入一个带有优先级的元素
    enqueue(element, priority) {
        // 创建队列元素
        const queueElement = {
            element: element,
            priority: priority
        }
        
        // 判断队列是否为空
        if (this.isEmpty()) {
            this.items.push(queueElement)
        } else {
            // 查找合适的插入位置
            let added = false
            for (let i = 0; i < this.items.length; i++) {
                if (queueElement.priority < this.items[i].priority) {
                    this.items.splice(i, 0, queueElement)
                    added = true
                    break
                }
            }
            // 如果没有找到合适位置，添加到队列末尾
            if (!added) {
                this.items.push(queueElement)
            }
        }
    }
    
    // 出队：移除并返回队首元素
    delqueue() {
        return this.items.shift()
    }
    
    // 查看队首元素
    front() {
        return this.items[0]
    }
    
    // 判断队列是否为空
    isEmpty() {
        return this.items.length === 0
    }
    
    // 获取队列大小
    size() {
        return this.items.length
    }
    
    // 转换为字符串
    toString() {
        let str = ''
        for (let i = 0; i < this.items.length; i++) {
            str += this.items[i].element
        }
        return str
    }
    
    // 增强版toString方法（显示元素和优先级）
    toStringEnhanced() {
        let str = '['
        for (let i = 0; i < this.items.length; i++) {
            if (i > 0) {
                str += ', '
            }
            str += `{element: "${this.items[i].element}", priority: ${this.items[i].priority}}`
        }
        str += ']'
        return str
    }
}
```

通过这个封装的优先级队列类，我们可以方便地在JavaScript中使用优先级队列这种数据结构，并应用到各种实际场景中，如任务调度、事件处理、图算法等需要按照优先级处理元素的场景。